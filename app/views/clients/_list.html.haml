%span{:style => "font-family: Georgia; font-size: 2em;"} 
  == #{@clients.count rescue 0} clients in this center

.menu-strip
  %b Key =>
  %span.applied applied
  %span.approved approved
  %span.outstanding outstanding
  %span.repaid repaid
  %span.arrears in arrears
  %span.written-off written-off
  %span.preclosed preclosed
- if @clients.blank? and @center.client_groups.length==0 and @loans.clients.empty?
  %p
    %i== No clients for the #{@branch.name} branch yet.
- else
  %table.narrow.form{ :width => '100%' }
    %thead
      %tr
        %th
        %th id
        %th name
        %th loans
        %th
    %tbody
    - group=-1
    - unless @clients.empty?
      - grouped_clients(@clients).each do |group, clients|
        %tr.group
          %td{:colspan => 5}
            - if group
              %b
                = link_to group.name, resource(group)
                (
                = link_to('edit', resource(@branch, @center, group, :edit))
                )
            - else
              Not attached to any group
        - clients.sort_by{|c| c.name}.each do |client|
          = partial 'clients/list_client_row', :client => client
    - debugger
    %tr.group
      %td{:colspan => 5}
        Loans whose clients are elsewhere
    - (@loans.clients.uniq - @clients.uniq).each do |client|
      = partial 'clients/list_client_row', :client => client
    - ClientGroup.all(:center => @center).reject{|cg| cg.clients.count!=0}.each do |client_group|
      %tr.group
        %td{:colspan => 5}
          %b
            = link_to client_group.name, resource(client_group)
            (
            = link_to('edit', resource(@branch, @center, client_group, :edit))
            )
      %tr
        %td{:colspan => 5}
          %i No clients yet in this group
    %tfoot
      %tr
        %td{ :colspan => 7 }

